{"expireTime":9007200870884090000,"key":"transformer-remark-markdown-html-e2833ad0bd391a059ab357318d8bc4b8-gatsby-remark-custom-blocks-/SonarQubeChineseDoc8.1","val":"<p><em>Security Engine Custom Configuration is available as part of the <a href=\"https://redirect.sonarsource.com/editions/enterprise.html\">Enterprise Edition</a> and <a href=\"https://www.sonarsource.com/plans-and-pricing/\">above</a>.</em></p>\n<p>The security engine tracks the path that data follows through your code. It detects when data that's potentially manipulated by a malicious user reaches a sensitive piece of code where an attack can occur.</p>\n<p>Those potentially malicious data are also called <strong>tainted data</strong>, because they are tainted by user inputs. </p>\n<p>SonarQube's security engine already knows a lot of APIs that are potential sources of attack and APIs that are potential targets of attack. While we do our best to identify publicly available APIs, we can't know everything about your homemade frameworks particularly when it comes to sanitizing your data. Because of this, SonarQube allows you to customize the security engine to add your own \"sources\", \"sanitizers\", \"passthroughs\", and \"sinks\" (see the <strong>Elements</strong> section below for more on these elements).</p>\n<p>For example, you may want to:</p>\n<ul>\n<li>add a source to add support for a framework that SonarQube doesn't cover out of the box</li>\n<li>use a custom sanitizer to tell to the security engine that all data going through sanitizers should be considered as safe. This allows you to remove false positives and tailor the security engine to your company.</li>\n</ul>\n<h2>Elements</h2>\n<p>You can add the following elements to your custom configuration:</p>\n<ul>\n<li><strong>Source</strong> – Where you get user data. You should always consider user data tainted and vulnerable to injection attacks.\nExample: Calling <code>HttpServletRequest#getParam(\"foo\")</code> will return tainted content</li>\n<li><strong>Sanitizer</strong> – Finds and removes malicious content from tainted data.</li>\n<li><strong>Passthrough</strong> – Allows you to keep track of tainted data sent to a library outside of the current function. When you pass a tainted value to a library functions outside of the current function, SonarQube automatically assumes it's being passed to a sanitizer. If the tainted data isn't being passed to a sanitizer, you can set up a passthrough to keep track of the data.</li>\n<li><strong>Sink</strong> – A piece of code that can perform a security sensitive task. Data should not contain any malicious content once it reaches a sink.\nExample: Running an SQL query with <code>java.sql.Statement#execute</code></li>\n</ul>\n<h2>Analysis Parameters</h2>\n<p>To customize the SonarQube security engine, you need to feed security configuration data through parameters given to the SonarScanners. To do this, you should provide JSON files with the value of the new analysis parameters. The parameters should use the following syntax:</p>\n<pre><code>sonar.security.[ConfigType].[RuleRepository].[RuleKey]=[FileName]\n</code></pre>\n<p>The <code>ConfigType</code> value can be one of the following:</p>\n<ul>\n<li><code>sources</code></li>\n<li><code>sanitizers</code></li>\n<li><code>passthroughs</code></li>\n<li><code>sinks</code></li>\n</ul>\n<p>The <code>RuleRepository</code> value can be one of the following:</p>\n<ul>\n<li><code>javasecurity</code>: if you want to customize the Java Security Engine</li>\n<li><code>phpsecurity</code>: if you want to customize the PHP Security Engine</li>\n<li><code>roslyn.sonaranalyzer.security.cs</code>: if you want to customize the C# Security Engine</li>\n</ul>\n<p>The <code>RuleKey</code> value can be one of the following:</p>\n<ul>\n<li>\n<p>For Java</p>\n<ul>\n<li><a href=\"https://rules.sonarsource.com/java/RSPEC-3649\">S3649</a>: SQL Injection</li>\n<li><a href=\"https://rules.sonarsource.com/java/RSPEC-5131\">S5131</a>: XSS</li>\n<li><a href=\"https://rules.sonarsource.com/java/RSPEC-5146\">S5146</a>: Open Redirect</li>\n<li><a href=\"https://rules.sonarsource.com/java/RSPEC-5167\">S5167</a>: HTTP Response Splitting</li>\n<li><a href=\"https://rules.sonarsource.com/java/RSPEC-2083\">S2083</a>: Path Traversal Injection</li>\n<li><a href=\"https://rules.sonarsource.com/java/RSPEC-2078\">S2078</a>: LDAP Injection</li>\n<li><a href=\"https://rules.sonarsource.com/java/RSPEC-5145\">S5145</a>: Log Injection</li>\n<li><a href=\"https://rules.sonarsource.com/java/RSPEC-2076\">S2076</a>: OS Command Injection</li>\n<li><a href=\"https://rules.sonarsource.com/java/RSPEC-2631\">S2631</a>: RegExp Injection</li>\n<li><a href=\"https://rules.sonarsource.com/java/RSPEC-5144\">S5144</a>: Server-Side Request Forgery (SSRF)</li>\n<li><a href=\"https://rules.sonarsource.com/java/RSPEC-2091\">S2091</a>: XPath Injection</li>\n<li><a href=\"https://rules.sonarsource.com/java/RSPEC-5135\">S5135</a>: Deserialization Injection</li>\n<li><a href=\"https://rules.sonarsource.com/java/RSPEC-5334\">S5334</a>: Code Injection</li>\n</ul>\n</li>\n<li>\n<p>For PHP</p>\n<ul>\n<li><a href=\"https://rules.sonarsource.com/php/RSPEC-3649\">S3649</a>: SQL Injection</li>\n<li><a href=\"https://rules.sonarsource.com/php/RSPEC-5131\">S5131</a>: XSS</li>\n<li><a href=\"https://rules.sonarsource.com/php/RSPEC-5146\">S5146</a>: Open Redirect</li>\n<li><a href=\"https://rules.sonarsource.com/php/RSPEC-5167\">S5167</a>: HTTP Response Splitting</li>\n<li><a href=\"https://rules.sonarsource.com/php/RSPEC-2083\">S2083</a>: Path Traversal Injection</li>\n<li><a href=\"https://rules.sonarsource.com/php/RSPEC-2078\">S2078</a>: LDAP Injection</li>\n<li><a href=\"https://rules.sonarsource.com/php/RSPEC-5145\">S5145</a>: Log Injection</li>\n<li><a href=\"https://rules.sonarsource.com/php/RSPEC-2076\">S2076</a>: OS Command Injection</li>\n<li><a href=\"https://rules.sonarsource.com/php/RSPEC-2631\">S2631</a>: RegExp Injection</li>\n<li><a href=\"https://rules.sonarsource.com/php/RSPEC-5144\">S5144</a>: Server-Side Request Forgery (SSRF)</li>\n<li><a href=\"https://rules.sonarsource.com/php/RSPEC-2091\">S2091</a>: XPath Injection</li>\n<li><a href=\"https://rules.sonarsource.com/php/RSPEC-5135\">S5135</a>: Deserialization Injection</li>\n<li><a href=\"https://rules.sonarsource.com/php/RSPEC-5334\">S5334</a>: Code Injection</li>\n<li><a href=\"https://rules.sonarsource.com/php/RSPEC-5335\">S5335</a>: Include Injection</li>\n</ul>\n</li>\n<li>\n<p>For C#</p>\n<ul>\n<li><a href=\"https://rules.sonarsource.com/csharp/RSPEC-3649\">S3649</a>: SQL Injection</li>\n<li><a href=\"https://rules.sonarsource.com/csharp/RSPEC-5131\">S5131</a>: XSS</li>\n<li><a href=\"https://rules.sonarsource.com/csharp/RSPEC-5146\">S5146</a>: Open Redirect</li>\n<li><a href=\"https://rules.sonarsource.com/csharp/RSPEC-5167\">S5167</a>: HTTP Response Splitting</li>\n<li><a href=\"https://rules.sonarsource.com/csharp/RSPEC-2083\">S2083</a>: Path Traversal Injection</li>\n<li><a href=\"https://rules.sonarsource.com/csharp/RSPEC-2078\">S2078</a>: LDAP Injection</li>\n<li><a href=\"https://rules.sonarsource.com/csharp/RSPEC-5145\">S5145</a>: Log Injection</li>\n<li><a href=\"https://rules.sonarsource.com/csharp/RSPEC-2076\">S2076</a>: OS Command Injection</li>\n<li><a href=\"https://rules.sonarsource.com/csharp/RSPEC-2631\">S2631</a>: RegExp Injection</li>\n<li><a href=\"https://rules.sonarsource.com/csharp/RSPEC-5144\">S5144</a>: Server-Side Request Forgery (SSRF)</li>\n<li><a href=\"https://rules.sonarsource.com/csharp/RSPEC-2091\">S2091</a>: XPath Injection</li>\n</ul>\n</li>\n</ul>\n<div class=\"custom-block alert alert-info\"><div class=\"custom-block-body\"><p>The configuration works per rule. There is no way to share configuration between rules. </p></div></div>\n<h2>File Format</h2>\n<p>The configuration is provided through JSON files. Here is a sample JSON file that help to understand the expected JSON format.</p>\n<p><strong>JSON File Format Example for PHP</strong></p>\n<pre><code>{\n  \"sources\": [\n    {\n      \"methodId\": \"My\\\\Namespace\\\\ClassName\\\\ServerRequest::getQuery\"\n    }\n  ],\n  \"sanitizers\": [\n    {\n      \"methodId\": \"str_replace\"\n    }\n  ],\n  \"passthroughs\": [\n    {\n      \"methodId\": \"rawurldecode\",\n      \"args\": [\n        1\n      ]\n    }\n  ],\n  \"sinks\": [\n    {\n      \"methodId\": \"mysql_query\",\n      \"args\": [\n        1\n      ]\n    },\n    {\n      \"methodId\": \"My\\\\Namespace\\\\SqlStatement::execute\",\n      \"isMethodPrefix\": true, // this is to say that all the methods starting with execute on the SqlStatement object will be considered\n      \"args\": [\n        0,\n        1\n      ]\n    },\n    {\n      \"methodId\": \"My\\\\Namespace\\\\SqlStatement::run\",\n      \"interval\": {\n        \"fromIndex\": 1 // every parameter from the number 1 will be considered\n      }\n    }\n  ]  \n}\n</code></pre>\n<p>The <code>args</code> is the index of the parameter that can receive a tainted variable. Index starts:</p>\n<ul>\n<li><code>1</code> for a fonction call. </li>\n<li><code>0</code> for a method call, index <code>0</code> beeing the current instance (<code>this</code>) </li>\n</ul>\n<h2>MethodId</h2>\n<p>All the custom configurations rely on the accuracy of the <code>methodIds</code> provided. For each language, the format of the <code>methodId</code> is different.</p>\n<h3>MethodId for Java</h3>\n<p>The <code>methodId</code> format is inspired by the bytecode. The easiest way to get a <code>methodId</code> is to write a simple piece of Java code, compile it and then look at the bytecode generated using the <code>javap -c path_to.class</code> file, and transform it a little. Looking at the following real-life example will help you understand the format.</p>\n<p>Let's imagine you want to declare <code>org.rapidoid.jdbc.JdbcClient.execute(String sql, Object... args)</code> as a new sink (you don't need to do this because Rapidoid is part of what is covered out of the box).</p>\n<p>Write a simple piece of code calling the JdbcClient.execute(...) method. The code doesn't need to actually do anything.</p>\n<pre><code>import org.rapidoid.http.Req;\nimport org.rapidoid.jdbc.JdbcClient;\n\npublic static void callJDBCMethods(Req req) {\n  String tainted = req.param(\"TAINTED\");\n  JdbcClient jdbc = JDBC.api();\n  dbc.execute(tainted, req); // Noncompliant\n}      \n</code></pre>\n<p>Run the <code>javap -c</code> and locate the piece of bytecode corresponding to the call to <code>JdbcClient.execute</code></p>\n<pre><code>[...]\norg/rapidoid/jdbc/JdbcClient.execute:(Ljava/lang/String;[Ljava/lang/Object;)I\n[...]\n</code></pre>\n<ul>\n<li>Replace the <code>/</code> in the package name with  <code>.</code></li>\n<li>Remove the <code>:</code></li>\n<li>Replace the <code>.</code> separating the Class name and the Method name with a <code>#</code></li>\n</ul>\n<p>The resulting <code>methodId</code> is:</p>\n<pre><code>org.rapidoid.jdbc.JdbcClient#execute(Ljava/lang/String;[Ljava/lang/Object;)I\n</code></pre>\n<h3>MethodId for PHP</h3>\n<p>The <code>methodId</code> can be:</p>\n<ul>\n<li>the name of a PHP function </li>\n<li>the fully qualified name of a method following this format: <code>namespace\\\\ClassName::methodName</code></li>\n</ul>\n<p>Example: <code>Symfony\\\\Component\\\\HttpFoundation\\\\Request::getUser</code> for the <code>getUser()</code> method of the <code>Request</code> object provided by <code>Symfony</code></p>\n<p>Note: the <code>methodId</code> should be related to methods or functions that are part of the analysis scope. Because we recommended to not analyze code of frameworks at the same time that you scan your own source code, defining methods or functions from frameworks will have no effect.\nThis is linked to the fact that the SonarQube security engine needs to know the runtime type of each variable. The type can't be guessed when objects are created by frameworks' factories. Out of the box, the SonarQube security engine supports the main Symfony and Laravel types.</p>\n<h3>MethodId for C#</h3>\n<p>If you want to declare the constructor <code>SqlCommand</code> belonging to the namespace <code>System.Data.SqlClient</code> as a sink, the <code>methodId</code> should be:</p>\n<pre><code>System.Data.SqlClient.SqlCommand.SqlCommand(string, System.Data.SqlClient.SqlConnection)\n</code></pre>\n<p>You simply need to provide the fully qualified name of the method or constructor plus the types of the arguments.</p>\n<h2>Deactivate Core Configuration</h2>\n<p>You can disable the core configuration per language or per rule using the following:</p>\n<pre><code>sonar.security.[ConfigType].[RuleRepository].noDefaultConfig=[true|false]\nsonar.security.[ConfigType].[RuleRepository].[RuleKey].noDefaultConfig=[true|false]\n</code></pre>"}