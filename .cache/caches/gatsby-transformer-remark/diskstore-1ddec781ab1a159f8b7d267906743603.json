{"expireTime":9007200870884089000,"key":"transformer-remark-markdown-html-691929b3f3667076a9c3ac5bc9e33ca9-gatsby-remark-custom-blocks-/SonarQubeChineseDoc8.1","val":"<p>Webhooks notify external services when a project analysis is complete. An HTTP POST request including a JSON payload is sent to each URL. URLs may be specified at both the project and global levels. Project-level specification does not replace global-level webhooks. All hooks at both levels are called.</p>\n<p>The HTTP(S) call:</p>\n<ul>\n<li>is made regardless of the status of the Background Task</li>\n<li>includes a JSON document as payload, using the POST method</li>\n<li>has a content type of \"application/json\", with UTF-8 encoding</li>\n</ul>\n<h2>Configuration</h2>\n<p>You can configure up to 10 webhooks in in <strong>Administration > Webhooks</strong>.</p>\n<p>An additional set of 10 webhooks can be configured at the global level in <strong>Administration > Configuration > Webhooks</strong>.</p>\n<p>If configured, all 20 will be executed.</p>\n<h2>Delivery and Payload</h2>\n<h3>Delivery</h3>\n<p>The Webhook administration console shows the result and timestamp of the most recent delivery of each webhook with the payload available via the list icon. Results and payloads of earlier deliveries are available from the tools menu to the right of each webhook.</p>\n<p>Response records are purged after 30 days.</p>\n<p>The URL must respond within 10 seconds or the delivery is marked as failed.</p>\n<h3>Payload</h3>\n<p>An HTTP header \"X-SonarQube-Project\" with the project key is sent to allow quick identification of the project involved.</p>\n<p>The Payload is a JSON document which includes:</p>\n<ul>\n<li>when the analysis was performed: see \"analysedAt\"</li>\n<li>the identification of the project analyzed: see \"project\"</li>\n<li>each Quality Gate criterion checked and its status: see \"qualityGate\"</li>\n<li>the Quality Gate status of the project: see \"qualityGate.status\"</li>\n<li>the status and the identifier of the Background Task : see \"status\" and \"taskId\"</li>\n<li>user-specified properties: see \"properties\"</li>\n</ul>\n<h4>Example</h4>\n<pre><code>{\n    \"serverUrl\": \"http://localhost:9000\",\n    \"taskId\": \"AVh21JS2JepAEhwQ-b3u\",\n    \"status\": \"SUCCESS\",\n    \"analysedAt\": \"2016-11-18T10:46:28+0100\",\n    \"revision\": \"c739069ec7105e01303e8b3065a81141aad9f129\",\n    \"project\": {\n        \"key\": \"myproject\",\n        \"name\": \"My Project\",\n        \"url\": \"https://mycompany.com/sonarqube/dashboard?id=myproject\"\n    },\n    \"properties\": {\n    },\n    \"qualityGate\": {\n        \"conditions\": [\n            {\n                \"errorThreshold\": \"1\",\n                \"metric\": \"new_security_rating\",\n                \"onLeakPeriod\": true,\n                \"operator\": \"GREATER_THAN\",\n                \"status\": \"OK\",\n                \"value\": \"1\"\n            },\n            {\n                \"errorThreshold\": \"1\",\n                \"metric\": \"new_reliability_rating\",\n                \"onLeakPeriod\": true,\n                \"operator\": \"GREATER_THAN\",\n                \"status\": \"OK\",\n                \"value\": \"1\"\n            },\n            {\n                \"errorThreshold\": \"1\",\n                \"metric\": \"new_maintainability_rating\",\n                \"onLeakPeriod\": true,\n                \"operator\": \"GREATER_THAN\",\n                \"status\": \"OK\",\n                \"value\": \"1\"\n            },\n            {\n                \"errorThreshold\": \"80\",\n                \"metric\": \"new_coverage\",\n                \"onLeakPeriod\": true,\n                \"operator\": \"LESS_THAN\",\n                \"status\": \"NO_VALUE\"\n            }\n        ],\n        \"name\": \"SonarQube way\",\n        \"status\": \"OK\"\n    }\n}\n</code></pre>\n<h2>Securing your webhooks</h2>\n<p>After you've configured your server to receive payloads, you want to be sure that the payloads you receive are initiated by SonarQube and not by hackers. You can do this by validating a hash signature that ensures that requests originate from SonarQube. </p>\n<h3>Setting your secret</h3>\n<p>To set your secret in SonarQube:</p>\n<ol>\n<li>From the project or organization where you're securing your webhooks, navigate to the webhooks settings at <strong>Administration > webhooks</strong></li>\n<li>You can either click <strong>Create</strong> to create a new webhook or click an existing webhook's settings drop-down and click <strong>Update</strong>.</li>\n<li>Enter a random string in the <strong>Secret</strong> text box. This is used as the key to generate the HMAC hex digest value in the <code>X-Sonar-Webhook-HMAC-SHA256</code> header.</li>\n<li>Click <strong>Update</strong>. </li>\n</ol>\n<h3>Validating SonarQube Payloads</h3>\n<p>After setting your secret, it's used by SonarQube to create a hash signature with each payload that's passed using the <code>X-Sonar-Webhook-HMAC-SHA256</code> HTTP header. The header value needs to match the signature you are expecting to receive. SonarQube uses a HMAC lower-case SHA256 digest to compute the signature of the request body. Here's some sample Java code for your server:</p>\n<pre><code>private static boolean isValidSignature(YourHttpRequest request) {\n  String receivedSignature = request.getHeader(\"X-Sonar-Webhook-HMAC-SHA256\");\n  // See Apache commons-codec\n  String expectedSignature = new HmacUtils(HmacAlgorithms.HMAC_SHA_256, \"your_secret\").hmacHex(request.getBody())\n  return Objects.equals(expectedSignature, receivedSignature);  \n}\n</code></pre>\n<p>If the signatures don't match, then the payload should be ignored.</p>\n<h2>Additional parameters</h2>\n<p>A basic authentication mechanism is supported by providing user/password in the URL of the Webhook such as <code>https://myLogin:myPassword@my_server/foo</code>.</p>\n<p>If you provide additional properties to your SonarScanner using the pattern <code>sonar.analysis.*</code>, these properties will be automatically added to the section \"properties\" of the payload.</p>\n<p>For example these additional parameters:</p>\n<pre><code>sonar-scanner -Dsonar.analysis.buildNumber=12345\n</code></pre>\n<p>Would add this to the payload:</p>\n<pre><code>\"properties\": {\n  \"sonar.analysis.buildNumber\": \"12345\"\n}\n</code></pre>"}